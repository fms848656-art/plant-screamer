<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Virtual Plant Screamer üå±üò±</title>
<style>
  :root{
    --bg:#0f172a;          /* slate-900 */
    --card:#111827;        /* gray-900 */
    --text:#e5e7eb;        /* gray-200 */
    --muted:#9ca3af;       /* gray-400 */
    --accent:#22c55e;      /* green-500 */
    --accent-2:#ef4444;    /* red-500 */
    --accent-3:#f59e0b;    /* amber-500 */
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
    background: radial-gradient(1200px 800px at 70% -20%, #1f2937 0%, var(--bg) 60%);
    color:var(--text);
    overflow-x:hidden;
  }
  .wrap{
    max-width:980px;margin:0 auto;padding:24px;
    display:grid;gap:24px;
    grid-template-columns: 1fr;
  }
  header{
    display:flex;align-items:center;justify-content:space-between;gap:16px;
  }
  h1{font-size:clamp(22px,4vw,34px);margin:0;font-weight:800;letter-spacing:.2px}
  .badge{font-size:12px;padding:6px 10px;border-radius:999px;background:#0b1220;color:var(--muted);border:1px solid #22314d}
  .card{
    background:linear-gradient(180deg, #0b1220, #0a0f1a);
    border:1px solid #1f2a44;
    border-radius:18px;padding:18px 18px 22px;
    box-shadow:0 10px 40px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.04);
  }
  .grid{
    display:grid;gap:18px;
    grid-template-columns: 1fr;
  }
  @media (min-width:900px){
    .grid{grid-template-columns: 1.2fr .8fr}
  }

  /* Plant stage */
  .stage{
    position:relative;isolation:isolate;
    display:grid;place-items:center;min-height:360px;
    border-radius:16px;background:
      radial-gradient(600px 260px at 50% 0%, rgba(34,197,94,.10), transparent 60%),
      linear-gradient(180deg, #0c1424, #0a0f1a 60%);
    overflow:hidden;
  }
  .ground{
    position:absolute;inset:auto 0 0 0;height:140px;
    background:
      radial-gradient(100% 60% at 50% 0%, rgba(34,197,94,.25), transparent 60%),
      linear-gradient(180deg, #0a1a12, #06120b);
    border-top:1px solid rgba(255,255,255,.04);
    z-index:0;
  }
  .plant{
    position:relative;z-index:1;width:min(360px,70vw);
    transition: transform .2s ease;
    filter: drop-shadow(0 10px 18px rgba(0,0,0,.45));
  }
  .screaming .plant{ animation: shake .22s linear infinite }
  @keyframes shake{
    0%{ transform:translateX(0) rotate(0deg) }
    25%{ transform:translateX(-2px) rotate(-.6deg) }
    50%{ transform:translateX(2px) rotate(.6deg) }
    75%{ transform:translateX(-1px) rotate(-.4deg) }
    100%{ transform:translateX(0) rotate(0deg) }
  }
  .flash{ position:absolute; inset:0; background:transparent; z-index:2; pointer-events:none; opacity:0 }
  .screaming .flash{
    animation: flash 1s steps(2,end) infinite;
  }
  @keyframes flash{
    0%,100%{ background: transparent; opacity:0 }
    50%{ background: rgba(239,68,68,.18); opacity:1 }
  }

  /* Controls */
  .controls{display:flex;flex-wrap:wrap;gap:12px}
  button, .select, .toggle{
    appearance:none;border:none;border-radius:12px;padding:12px 14px;font-weight:700;
    background:#0e1a2c;color:var(--text);border:1px solid #1f2a44;cursor:pointer;
    transition: transform .04s ease, border-color .2s ease, background .2s ease, box-shadow .2s ease;
    box-shadow:0 6px 20px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.04);
  }
  button:hover, .select:hover, .toggle:hover{ border-color:#33508a }
  button:active{ transform: translateY(1px) }
  .primary{ background: linear-gradient(180deg, #1d7a45, #0d5b2e); border-color:#2b8a57 }
  .danger{ background: linear-gradient(180deg, #7a1d1d, #5b0d0d); border-color:#8a2b2b }
  .mutedBtn{ background:#0b1220;color:var(--muted) }
  .select{ display:flex; align-items:center; gap:8px }
  select{
    background:transparent;border:none;color:var(--text);font-weight:700;outline:none
  }

  /* Info rows */
  .row{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:12px 0}
  .row small{color:var(--muted)}
  .meter{
    --p:0;
    height:12px;border-radius:999px;background:#0b1220;border:1px solid #22314d;overflow:hidden;
    position:relative;
  }
  .meter::after{
    content:"";position:absolute;left:0;top:0;bottom:0;width: calc(var(--p) * 1%);background:
      linear-gradient(90deg, #22c55e, #f59e0b 70%, #ef4444 100%);
    transition: width .4s ease;
  }

  .status{
    display:flex;align-items:center;gap:10px;flex-wrap:wrap
  }
  .status .pill{
    padding:6px 10px;border-radius:999px;border:1px solid #22314d;background:#0b1220;font-size:12px
  }
  .status .pill.red{ border-color:#5c1b1b;background:#2b0c0c;color:#fecaca }
  .status .pill.green{ border-color:#1b5c2a;background:#0d2b17;color:#bbf7d0 }
  .status .pill.amber{ border-color:#5c441b;background:#2b1a0c;color:#fde68a }
  .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
  a.link{ color:#a5b4fc; text-decoration:none; border-bottom:1px dashed rgba(165,180,252,.4) }
  a.link:hover{ border-bottom-color:rgba(165,180,252,.9) }
  /* ==== Floating Plant Emoji Background ==== */
#background {
  position: fixed;
  inset: 0;
  overflow: hidden;
  z-index: -1; /* stay behind everything */
  background: radial-gradient(circle at top, rgba(34,197,94,0.05), transparent 70%);
}

.emoji {
  position: absolute;
  font-size: 1.6rem;
  animation: floatUp 6s linear forwards;
  opacity: 0.9;
  text-shadow: 0 0 6px rgba(255,255,255,0.6);
}

@keyframes floatUp {
  0%   { transform: translateY(100vh) scale(0.8) rotate(0deg); opacity: 0; }
  20%  { opacity: 1; }
  100% { transform: translateY(-10vh) scale(1.2) rotate(360deg); opacity: 0; }
}

</style>
</head>
<body>
  <div id="background"></div>
  <div class="wrap">
    <header>
      <h1>Virtual Plant Screamer</h1>
      <span class="badge">Don‚Äôt forget to water it‚Ä¶ or else üò±</span>
    </header>

    <div class="grid">
      <!-- Left: Plant Stage -->
      <section class="card stage" id="stage" aria-live="polite" aria-atomic="true">
        <div class="flash" aria-hidden="true"></div>

        <!-- SVG Plant (cute face on the pot) -->
        <svg class="plant" viewBox="0 0 520 520" role="img" aria-label="Digital plant in a pot that may scream">
          <!-- leaves -->
          <g id="leaves">
            <path d="M260 150 C220 90 210 40 260 20 C310 40 300 90 260 150 Z" fill="#34d399"/>
            <path d="M260 150 C300 80 350 60 380 100 C360 140 320 150 260 150 Z" fill="#10b981"/>
            <path d="M260 150 C220 80 170 60 140 100 C160 140 200 150 260 150 Z" fill="#059669"/>
            <rect x="250" y="150" width="20" height="80" rx="10" fill="#15803d"/>
          </g>
          <!-- pot -->
          <g id="pot">
            <path d="M120 260 h280 l-40 160 a40 40 0 0 1 -39 30 h-122 a40 40 0 0 1 -39 -30 Z" fill="#f59e0b"/>
            <rect x="100" y="240" width="320" height="40" rx="12" fill="#d97706"/>
            <!-- cute face -->
            <circle cx="220" cy="330" r="12" fill="#111827"/>
            <circle cx="300" cy="330" r="12" fill="#111827"/>
            <rect id="mouth" x="240" y="350" width="40" height="8" rx="4" fill="#111827"/>
          </g>
        </svg>

        <div class="ground"></div>
      </section>

      <!-- Right: Controls / Status -->
      <section class="card">
        <div class="controls" role="group" aria-label="Plant controls">
          <button id="waterBtn" class="primary" title="Give water (resets timer)">üíß Water Now</button>
          <button id="muteBtn" class="mutedBtn" aria-pressed="false" title="Toggle sound">üîá Mute</button>
          <button id="testScreamBtn" class="danger" title="Trigger a test scream">üò± Test Scream</button>
          <label class="select" title="How long before the plant screams">
            ‚è±Ô∏è Thirst Interval
            <select id="intervalSelect" aria-label="Thirst interval">
              <!-- Short defaults for demo; pick longer if you like -->
              <option value="30">30s (demo)</option>
              <option value="60">1 min</option>
              <option value="180">3 min</option>
              <option value="300">5 min</option>
              <option value="900">15 min</option>
            </select>
          </label>
        </div>

        <div class="row">
          <div>
            <div>Last watered: <strong id="lastWateredLabel">‚Äî</strong></div>
            <small class="muted">Keep it happy by watering before the timer runs out.</small>
          </div>
        </div>

        <div class="row">
          <div class="status">
            <span id="statusPill" class="pill green">Happy</span>
            <span class="pill">Elapsed: <span id="elapsed">0s</span></span>
            <span class="pill">Threshold: <span id="threshold">30s</span></span>
          </div>
        </div>

        <div class="row" aria-label="Dryness meter">
          <div style="width:100%">
            <div class="meter" id="meter" style="--p:0"></div>
            <small class="muted">Fills up as the plant dries out.</small>
          </div>
        </div>

        <div class="row">
          <small>Tip: Enable site notifications if you want a desktop alert when it starts screaming. <a class="link" href="#" id="enableNoti">Enable</a></small>
        </div>
      </section>
    </div>

    <footer style="opacity:.7">
      <small>Made for laughs. No plants were harmed. üåø</small>
    </footer>
  </div>

<script>
/* ====== Utilities ====== */
const $ = sel => document.querySelector(sel);
const fmt = secs => {
  if (secs < 60) return `${Math.floor(secs)}s`;
  const m = Math.floor(secs/60), s = Math.floor(secs%60);
  return `${m}m ${s}s`;
};
const now = () => Date.now();

/* ====== State (persisted) ====== */
const STORAGE_KEY = "plantScreamerState.v1";
const state = {
  lastWatered: now(),
  intervalSec: 30,
  muted: false
};
try{
  const saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
  Object.assign(state, saved);
}catch{ /* ignore */ }

const save = () => localStorage.setItem(STORAGE_KEY, JSON.stringify(state));

/* ====== Elements ====== */
const stage = $("#stage");
const mouth = $("#mouth");
const waterBtn = $("#waterBtn");
const muteBtn = $("#muteBtn");
const testBtn = $("#testScreamBtn");
const intervalSelect = $("#intervalSelect");
const lastWateredLabel = $("#lastWateredLabel");
const elapsedLbl = $("#elapsed");
const thresholdLbl = $("#threshold");
const meter = $("#meter");
const statusPill = $("#statusPill");
const enableNoti = $("#enableNoti");

/* Initialize controls from state */
intervalSelect.value = String(state.intervalSec);
muteBtn.textContent = state.muted ? "üîà Unmute" : "üîá Mute";
muteBtn.setAttribute("aria-pressed", String(state.muted));
thresholdLbl.textContent = fmt(state.intervalSec);
updateLastWateredLabel();

/* ====== Audio: generate a ‚Äúscream‚Äù with Web Audio (no external files) ====== */
let audioCtx = null;

function ensureAudio() {
  if (!audioCtx) {
    const Ctx = window.AudioContext || window.webkitAudioContext;
    audioCtx = new Ctx();
  }
}

function playScream(){
  if (state.muted) return;

  ensureAudio();

  // Create a noisy, rising-pitch screech + noise burst
  const duration = 1.2; // seconds
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  const noise = audioCtx.createBufferSource();
  const noiseGain = audioCtx.createGain();

  // Oscillator: start medium pitch and ramp up
  osc.type = "sawtooth";
  osc.frequency.setValueAtTime(380, audioCtx.currentTime);
  osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + duration * 0.6);
  osc.frequency.setTargetAtTime(260, audioCtx.currentTime + duration * 0.6, 0.25);

  // Main gain envelope (fast attack, short decay)
  gain.gain.setValueAtTime(0.0001, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.7, audioCtx.currentTime + 0.05);
  gain.gain.exponentialRampToValueAtTime(0.25, audioCtx.currentTime + 0.25);
  gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);

  // Pink-ish noise buffer
  const buffer = audioCtx.createBuffer(1, audioCtx.sampleRate * duration, audioCtx.sampleRate);
  const data = buffer.getChannelData(0);
  let b0=0,b1=0,b2=0,b3=0,b4=0,b5=0,b6=0;
  for (let i=0;i<data.length;i++){
    const white = Math.random()*2-1;
    b0 = 0.99886*b0 + white*0.0555179;
    b1 = 0.99332*b1 + white*0.0750759;
    b2 = 0.96900*b2 + white*0.1538520;
    b3 = 0.86650*b3 + white*0.3104856;
    b4 = 0.55000*b4 + white*0.5329522;
    b5 = -0.7616*b5 - white*0.0168980;
    data[i] = (b0+b1+b2+b3+b4+b5+b6 + white*0.5362) * 0.2;
    b6 = white*0.115926;
  }
  noise.buffer = buffer;

  // Noise envelope
  noiseGain.gain.setValueAtTime(0.0001, audioCtx.currentTime);
  noiseGain.gain.exponentialRampToValueAtTime(0.6, audioCtx.currentTime + 0.03);
  noiseGain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);

  // Slight band-pass for scream brightness
  const bp = audioCtx.createBiquadFilter();
  bp.type = "bandpass";
  bp.frequency.value = 1200;
  bp.Q.value = 3;

  osc.connect(gain).connect(bp).connect(audioCtx.destination);
  noise.connect(noiseGain).connect(bp);

  osc.start();
  noise.start();
  osc.stop(audioCtx.currentTime + duration);
  noise.stop(audioCtx.currentTime + duration);
}

let screamIntervalId = null;
function startContinuousScreaming(){
  if (screamIntervalId) return;
  // Open mouth :)
  mouth.setAttribute("y", "340");
  mouth.setAttribute("height", "24");
  mouth.setAttribute("rx", "12");
  stage.classList.add("screaming");
  // Repeat a scream every ~1.2s
  playScream();
  screamIntervalId = setInterval(playScream, 1200);
  // Try a small vibration if available
  if (navigator.vibrate) navigator.vibrate([100, 50, 100]);
  // Desktop notification
  maybeNotify();
}

function stopContinuousScreaming(){
  if (screamIntervalId){
    clearInterval(screamIntervalId);
    screamIntervalId = null;
  }
  mouth.setAttribute("y", "350");
  mouth.setAttribute("height", "8");
  mouth.setAttribute("rx", "4");
  stage.classList.remove("screaming");
}

/* ====== Notifications ====== */
let notiGranted = (typeof Notification !== "undefined") && Notification.permission === "granted";

function requestNotificationPermission(){
  if (typeof Notification === "undefined") return alert("Notifications not supported in this browser.");
  Notification.requestPermission().then(p=>{
    notiGranted = p === "granted";
    if (notiGranted) new Notification("Plant Screamer", { body: "Notifications enabled! I‚Äôll yell at you when I‚Äôm thirsty." });
  });
}
function maybeNotify(){
  if (!notiGranted) return;
  new Notification("üò± Your plant is screaming!", {
    body: "Give it some water (click the üíß button)!",
  });
}

/* ====== Core timers / dryness ====== */
function updateLastWateredLabel(){
  const diff = Math.max(0, (now() - state.lastWatered)/1000);
  if (diff < 1) {
    lastWateredLabel.textContent = "just now";
  } else {
    lastWateredLabel.textContent = `${fmt(diff)} ago`;
  }
}

function setStatus(kind){
  if (kind === "happy"){
    statusPill.textContent = "Happy";
    statusPill.className = "pill green";
  } else if (kind === "warning"){
    statusPill.textContent = "Getting thirsty‚Ä¶";
    statusPill.className = "pill amber";
  } else {
    statusPill.textContent = "THIRSTY! (screaming)";
    statusPill.className = "pill red";
  }
}

function tick(){
  const elapsedSec = Math.max(0, (now() - state.lastWatered)/1000);
  const pct = Math.min(100, (elapsedSec / state.intervalSec) * 100);
  elapsedLbl.textContent = fmt(elapsedSec);
  meter.style.setProperty("--p", pct.toFixed(1));

  // status
  if (pct < 70){
    setStatus("happy");
  } else if (pct < 100){
    setStatus("warning");
  } else {
    setStatus("danger");
  }

  // cross threshold?
  if (elapsedSec >= state.intervalSec){
    startContinuousScreaming();
  } else {
    stopContinuousScreaming();
  }

  updateLastWateredLabel();
}

/* ====== Events ====== */
waterBtn.addEventListener("click", ()=>{
  state.lastWatered = now();
  save();
  tick();
});

muteBtn.addEventListener("click", ()=>{
  state.muted = !state.muted;
  muteBtn.textContent = state.muted ? "üîà Unmute" : "üîá Mute";
  muteBtn.setAttribute("aria-pressed", String(state.muted));
  save();
});

intervalSelect.addEventListener("change", ()=>{
  state.intervalSec = parseInt(intervalSelect.value, 10);
  thresholdLbl.textContent = fmt(state.intervalSec);
  save();
  tick();
});

testBtn.addEventListener("click", ()=>{
  // Trigger screaming for 3 seconds as a test
  startContinuousScreaming();
  setTimeout(()=> stopContinuousScreaming(), 3000);
});

enableNoti.addEventListener("click", (e)=>{
  e.preventDefault();
  requestNotificationPermission();
});

/* ====== Start loop ====== */
tick();
setInterval(tick, 500);
/* ==== Floating Plant Emojis ==== */
const emojis = ["üå±","üåø","üçÉ","üå∏","üåº","üåµ","üå∫"];
const bg = document.getElementById("background");

function spawnEmoji() {
  const e = document.createElement("div");
  e.className = "emoji";
  e.textContent = emojis[Math.floor(Math.random()*emojis.length)];
  e.style.left = Math.random()*100 + "vw";
  e.style.fontSize = (Math.random()*1.5 + 1.2) + "rem";
  e.style.animationDuration = (Math.random()*4 + 4) + "s";
  bg.appendChild(e);

  // Remove after animation ends
  setTimeout(()=> e.remove(), 6000);
}

// Keep spawning
setInterval(spawnEmoji, 800);

</script>
</body>
</html>
